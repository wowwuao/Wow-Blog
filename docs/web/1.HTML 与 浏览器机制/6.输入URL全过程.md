---
title: 6.输入URL到看到页面的全过程
group:
  path: /html
  title: HTML 与 浏览器机制
  order: 1
---
# 输入URL到看到页面的全过程

1. 浏览器会判断资源是否在缓存里，如果缓存没有失效，则直接使用否则发起新的请求。
2. 获取URL中的域名IP地址，首先会判断本地是否有该域名IP地址的缓存，如果有则使用，没有先向本地DNS服务器发起请求，如果本地DNS没有，则会向根域名服务器发起请求，获得负责的顶级域名服务器的地址后，在请求顶级域名服务器获取权威域名服务器的地址，在向权威域名服务器发起请求，最终获得域名的IP地址后，本地DNS将这个IP地址返回给用户。用户向本地DNS的请求属于递归请求，本地DNS服务器向各级域名服务器发起的请求属于迭代请求。
3. 得到IP地址之后，还需要获取目的主机的MAC地址，如果在一个子网里，使用ARP协议获取目的主机的MAC地址，如果不在一个子网里，则把请求转发给我们的网关，由它代为转发，同样通过ARP协议来获取网关的MAC地址，此时目的主机的MAC地址，应该为该网关的地址。
4. TCP连接的三次握手过程
5. HTTPS连接，TLS一个四次握手的过程
   1. 首先有客户端向服务器发送使用的协议的版本号、一个随机数、可以使用的加密方法。
   2. 服务端收到后，确认加密的方法，也向客户端发送一个随机数和自己的数字证书。
   3. 客户端收到后，首先检查数字证书是否有效，如果有效，则再生成一个随机数，并使用证书中的公钥对随机数进行加密，然后发送给服务端，并且还会提供一个前面所有内容的hash值供客户端检验。
   4. 服务端收到后，使用自己的私钥对数据解密，同时向客户端发送一个前面所有内容的hash值供客户端检验。
   5. 这个时候双方都有了三个随机数，使用这三个随机数生成一把密钥，以后双方通信之前都是用这个密钥对数据加密后再传输。

6. 将下载完的内容转交给Renderer进程管理，浏览器收到html文件之后，会构建DOM树，解析CSS文件构建 CSSOM树，这个过程是并行执行的。
7. 解析绘制的过程中，当浏览器遇到link标签或者script、img等标签，浏览器会去下载这些内容，会先看缓存，如果是强缓存且新鲜，可直接使用，否则发起协商缓存的请求，检查是否过期
8. 如果遇到script标签，则判断是否有defer或者async属性，否则script的加载会造成页面渲染阻塞。
9. 当css rule tree 和 dom tree生成完了之后，开始合成render tree，这个时候浏览器会进行layout，开始计算每一个节点的位置，然后进行绘制
10. 绘制结束后，关闭TCP连接，过程有四次挥手
