---
title: 14.合成事件
order: 14
group:
  path: /react
  title: React
  order: 8
---
## 合成事件
React基于浏览器的事件机制自身实现了一套事件机制，包括`事件注册`、`事件的合成`、`事件冒泡`、`事件派发`等，这套事件机制被称为合成事件。

合成事件是 react 模拟原生 DOM 事件所有能力的一个事件对象。

优点：
1. 根据W3C规范来定义合成事件，兼容所有浏览器，更好的跨平台
2. 将事件统一存放在一个数组，避免频繁的新增与删除（垃圾回收）
3. 方便 react 统一管理和事务机制

> 1. 事件的执行顺序为原生事件先执行，合成事件后执行
> 2. 合成事件会冒泡绑定到 document 上，所以尽量避免原生事件与合成事件混用，如果原生事件阻止冒泡，可能会导致合成事件不执行，因为需要冒泡到 document 上合成事件才会执行。

react 事件不能采用 return false 的方式来阻止浏览器默认行为，必须要使用 `preventDefault()` 来调用默认行为



## 事件代理
`SyntheticEvent`（合成事件层），定义的事件处理器会接受到一个合成事件对象的实例，符合W3C标准，且与原生的浏览器事件拥有同样的接口，支持冒泡机制，所有的事件都自动绑定在最外层上。

在React底层，主要对合成事件做了两件事：
* **事件委派**：React会把所有的事件`绑定到结构的最外层`，使用统一的`事件监听器`，用来维持一个映射来保存所有组件内部事件监听和处理函数。当组件挂载或卸载时，只是在这个统一的事件监听器上插入或删除一些对象；当事件发生时，首先被这个统一的事件监听器处理，然后在映射里找到真正的事件处理函数并调用。这样做简化了事件处理的回收机制，提升了效率。
*  **自动绑定**：React组件中，每个方法的上下文都会指向该组件的实例，自动绑定this为当前组件。而且React还会对这种应用进行缓存，以达到CPU和内存的最优化。在使用ES6 Class或者纯函数时，这种自动绑定就不复存在了，我们需要手动实现this绑定。

## 绑定方式
### bind
### constructor绑定
### 箭头函数

## 合成事件对比原生事件
### 事件传播与阻止事件传播
浏览器元素DOM事件和传播可以分为3个阶段：
1. 事件捕获阶段
2. 目标对象本身的事件处理程序调用
3. 事件冒泡阶段

事件捕获会优先调用结构树最外层的元素上绑定的事件监听器，然后依次向内调用，一直调用到目标元素上的事件监听器为止。可以在将`e.addEventListener()`的第三个参数设置为true，为元素e注册捕获事件处理程序，并且在事件传播的第一个阶段调用。

React的合成事件并没有实现事件捕获，`仅仅支持了事件冒泡机制`。这种API设计方式统一而简洁。

阻止原生事件传播需要使用`e.preventDefault()`

阻止合成事件冒泡：`e.stopPropagation()`



