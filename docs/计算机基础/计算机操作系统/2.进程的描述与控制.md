---
title: 2.进程的描述与控制
group:
  path: /os
  order: 1
---

# 进程的描述与控制

## 一.程序的并发执行
在同一个时间间隔内运行多个程序

特点：
1. 间断性
2. 多个程序共享系统资源（失去封闭性）
3. 不可再现性

## 二.进程的描述
### 1.定义和特征

**进程**：
1. 进程是允许并发执行的程序在某个数据集合上的执行过程
2. 进程是由用户数据、系统数据和程序构成的实体

**特征**：
* 并发性：多个进程实体，同存于内存中，能在一段时间内同时运行。
* 动态性：进程是进程实体的执行过程，对应了存储体的不断变化；有创建、执行、状态变化和运行终止被撤销的过程
* 独立性：独立运行和资源调度的基本单位
* 异步性：以不同的、不可预知的速度向前推进
* 结构特性：进程包括用户数据、系统数据、程序

**程序**和**进程**
区别：
1. 程序是静态的概念，进程是动态的概念
2. 程序是永久的，进程是暂时存在的
3. 程序与进程的存在实体不同
联系：
1. 进程是程序的一次执行，进程总是对应一个特定的程序，执行程序的代码，一个进程必然对应至少一段程序。
2. 一个程序可以对应多个进程。同一个程序段可以在不同的数据集合上运行，因而构成若干个不同的进程。

### 2.进程控制块PCB
**进程控制块**： Process Control Block。进程控制块是进程实体的一部分，`与进程一一对应`，是操作系统中最重要的记录型数据结构，PCB中记录了操作系统所需要的用于描述进程情况及控制进程运行所需的全部信息，`只有内核程序可以直接访问`。
#### 进程控制块中的信息
* 进程标识符信息：
  1. 外部标识符
  2. 内部标识符
  3. 父进程标识符
  4. 子进程标识符

* 处理机状态信息
  1. 通用寄存器
  2. 指令计数器
  3. 程序状态机PSW
  4. 用户栈指针

* 进程调度信息
  1. 进程状态信息
  2. 进程优先级
  3. 进程调度所需要的其他信息
  4. 事件

* 进程控制信息
  1. 程序和数据的地址
  2. 进程同步和通信机制
  3. 资源清单
  4. 链接指针


### 3.进程的基本状态
#### 进程的三种基本状态
1. 就绪状态：进程一旦获得CPU就可以投入运行的状态
2. 执行状态：进程获得CPU正在运行的状态
3. 阻塞状态：进程由于等待资源或者某个事件的发生而暂停执行的状态。

#### Linux的进程状态
Linux2.4.30进程状态
* 可运行状态（TASK_RUNNING)
* 可中断的等待状态（TASK_INTERRUPTIBLE)
* 不可中断的等待状态（TASK_UNINTERRUPTIBLE)
* 暂停状态（TASK_STOPPED)
* 僵死状态（TASK_ZOMBIE)

### 4.进程的组织
当系统中有很多进程时，可以用队列把进程控制块组织起来，形成`进程队列`。把具有相同状态的进程放在同一个队列中，具有不同状态的进程就可形成不同的进程队列。`处于就绪状态的进程构成的进程队列称为`**`就绪队列`**，`处于阻塞状态的进程构成的进程队列称为`**`阻塞队列`**。

* 链接方式
  把具有相同状态的PCB用其中的链接字，链接成一个队列

## 三.进程的控制
### 1.进程的创建
* 引起创建进程的事件
  1. 用户登录
  2. 作业调度
  3. 提供服务
  4. 应用请求

* 进程创建
  调用创建新进程的原语来创建进程，一般步骤为：
  1. 申请空白PCB
  2. 为新进程分配资源
  3. 初始化进程控制块
  4. 将新进程插入就绪队列

### 2.进程的阻塞
* 引起进程阻塞和唤醒的事件
1. 请求系统服务，如：打印服务
2. 启动某种操作，如：启动I/O 或 启动打印机
3. 新数据尚未到达，如：一个计算进程，如果新的输入数据还没有到达，则计算进程需要阻塞等待

* 进程阻塞的简化过程
1. 暂停进程的执行，将进程的状态改为阻塞态
2. 将进程插入相应的阻塞队列
3. 转进程调度程序，重新进行进程调度

### 3.进程的唤醒
* 进程唤醒过程
  1. 将进程从阻塞队列中移出
  2. 将进程状态由阻塞改为就绪
  3. 将进程插入就绪队列

### 4.进程的终止
* 引起进程终止的事件
  1. 正常结束
  2. 异常结束
  3. 外界干预

* 进程终止过程
  1. 从进程PCB中读进程状态
  2. 若进程正在执行则终止进程的执行
  3. 若进程有子孙进程则终止子孙进程*（不一定）
  4. 释放资源
  5. 将终止进程的PCB移除

### 系统引导过程
1. 执行BIOS程序将BOOT程序加载入内存
2. 执行BOOT程序，从外存找到Loader程序，将其加载入内存，并执行该程序
3. Loader程序将内核程序从外存加载入内存
4. 内核开始执行

## 四.操作系统内核
操作系统内核是对计算机硬件的第一次扩充

* 支撑功能
  * 中断处理、时钟管理、原子操作
* 资源管理功能
  * 进程管理、存储器管理、设备管理

### 1.中断
中断是`改变处理器执行指令顺序的一种事件`。`这样的事件与CPU芯片内外部硬件电路产生的电信号相对应`。

**引入中断机制，CPU可以与其它设备并行工作，能有效提高 CPU的利用率，改善系统性能，支持系统的异步性**

#### 中断类型
内部中断：（同步中断或异常）
> 除法出错、调试、溢出、浮点出错、页故障...

外部出错：（异步中断）
1. 外部可屏蔽中断（I/O设备产生的中断）
2. 外部不可屏蔽中断（紧急时间引起的中断，如硬件故障等）

<center><font color="red" size = 4>中断屏蔽</font></center>

* I/O设备发出的所有中断请求（IRQ）都产生可屏蔽中断
* 屏蔽中断可以处于两种状态：`屏蔽的(masked)`或`非屏蔽的(unmasked)`
* 一个屏蔽的中断只要还是屏蔽的，控制单元就忽略它
* 在Intel体系结构的CPU中，当eflags寄存器的IF标志被清0时，有PIC发出的每个可屏蔽中断都由CPU暂时忽略。内核可以使用cli和sti特权指令分别清除和设置IF标志。

#### 引起中断的原因
* 人为设置中断：在程序中人为设置中断
* 程序性事故：计算中出现除数0
* 硬件故障：插板接触不良、电源掉电等
* I/O设备：I/O设备被启动以后，一旦其准备就绪或I/O结束，便向CPU发出中断请求
* 外部事件：如用户通过键盘来中断现行程序
* ......

#### 中断响应
* 相应外部中断的条件：开中断
* 相应外部中断的时机：CPU每执行完一条指令
* 内部中断：随时有可能发生



