---
title: 1.操作系统概述
nav:
  order: 3
group:
  path: /os
  title: 计算机操作系统
  order: 1
---

# 计算机操作系统

## 一、什么是操作系统

### 1. 操作系统是用户与计算机硬件之间的接口
* 类型：
  * 命令行接口
  * 图形用户接口
  * 系统调用（只能通过用户程序间接调用）
* 优点：屏蔽控制硬件的细节，使应用程序的开发更简单、高效

从磁盘读文件的过程(2.3由系统内核完成)
> 1. 用户给出文件名，提出访问文件的请求
> 2. 文件系统通过`按名访问机制`获取文件的逻辑地址（磁盘块号或扇区编号）
> 3. 磁盘驱动程序将逻辑地址转换为物理地址、发送磁盘操作指令

### 2.操作系统是计算机资源的管理者
管理：处理机、内存、设备、文件、网络等

#### 操作系统设计追求的主要目标：
1. 方便用户（最终用户、程序员）
2. 提高系统性能：
   * 空间性能
   * 时间性能
   * 资源利用率

## 二、发展
* 第一代计算机：真空管与插件板
* 第二代计算机：晶体管 和 批处理系统
* 第三代计算机：集成电路芯片 和 多道程序系统
* 第四代计算机：实时系统的出现

### 单道批处理系统
* 特点：
  1. 自动性
  2. 顺序性
  3. 单道性
* 优点：
   减少等待人工操作的时间
* 缺点：
  1. 作业独占CPU
  2. CPU等待I/O使得CPU利用率低
  3. 内存中只有一道作业

### 多道批处理系统
最主要的硬件支持：中断系统技术、通道技术

中断技术使得多道批处理系统和I/O设备可与CPU并行工作。

* 特点：
  1. 多道性
  2. 无序性
  3. 调度性
  4. 复杂性
* 优点：
  1. `提高CPU利用率`
  2. 提高内存和I/O利用率
  3. 增加系统吞吐量
* 缺点：
  1. `平均周转时间`
  2. 缺乏交互能力


### 分时系统
通常采用`时间片轮转策略`为用户服务

采用`优先级+非抢占式调度算法`

* 特点：
  1. 多路性
  2. 独立性
  3. 及时性（同时性）
  4. 交互性
* 优点：
  1. 提供人机交互
  2. 多终端共享主机
* 分时系统实现中的关键问题
  1. 及时接受：及时接受用户的命令或数据
  2. 及时处理：及时处理用户命令。应该使所有的用户作业都直接进入内存；在很短的时间内使每个作业都得到运行

### 实时操作系统
实时系统是支持`实时计算`的系统
> 实时计算：`系统的正确性不仅取决于计算的逻辑结果，而且还依赖与产生结果的时间`

实时操作系统在`资源调度`、`中断处理`等方面的设计和实现要充分考虑系统对时间的限制。特殊领域的实时操作系统需要具有`高可靠性`

实时任务的类型：
1. 周期性实时任务
2. 非周期性实时任务
3. 硬实时任务
4. 软实时任务

### 网络操作系统(了解)
允许在一台主机上同时连接多台终端，多个用户可以通过各自的终端同时交互的使用计算机。

### 多任务操作系统(了解)
多任务操作系统可以在同一时间之内运行多个应用程序，多个任务必须互斥地访问共享资源，为达到这一目标必须对共享资源进行必要的保护。现代操作系统都是多任务的（主要的特点是并发和并行）

## 三、特征

**<font color="red">并发</font>**：**两个或多个事件在 `同一时间间隔` 内发生。并发强调"同一时间间隔"，与并行是不同的两个概念，并行是指多个事件同时发生。**

**<font color="red">共享</font>**：系统中的资源可供内存中多个并发执行的进程共同使用。资源贡献有两种方式，即：**互斥共享** 和 **同时共享**

**<font color="red">虚拟</font>**:通过某种技术把一个物理实体变成若干逻辑上的对应物。

**<font color="red">异步</font>**:进程以不可预知的顺序、进度运行，系统能处理随机发生的事件。

## 四、功能
* 内存管理功能
* 进程管理功能
* 设备管理功能
* 文件管理功能
* 用户接口

### 1.内存管理功能
* 内存分配
* 内存保护
  
      确保每道用户程序都在自己的内存空间中运行，互不干扰
* 地址映射
* 内存扩充
* 内存回收

### 2.进程管理工程
* 进程控制
* 进程同步
* 进程通信
* 进程调度
  
### 3.设备管理功能
* 缓冲管理：管理各种缓冲区
* 设备分配：分配用户I/O所需要的设备
* 设备处理：由设备驱动程序来实现CPU与设备控制器之间的通信。
* 设备独立性：应用程序与具体的物理设备无关
* 虚拟设备：多个用户、多个进程共享同一个物理设备

### 4.文件管理功能
* 文件的按名访问
* 文件的储存

### 5.提供用户接口
* 命令接口
* 图形接口：采用图形化的操作界面
* 程序接口：由一组系统调用组成

## 五、指令的执行
1. 程序执行的过程是反复取指令和执行指令的过程
2. PC始终存有下一条待取指令的地址
3. `指令执行的结果就是使寄存器或内存单元的值发生变化。指令执行的过程也就是存储体内容不断变化的过程。`
4. 取指令和执行指令是由硬件完成的
5. 不同硬件的体系结构支持不同的指令集合，为某周硬件平台开发的操作系统不能直接在另一种体系结构的硬件上运行。
6. `任何高级语言被编译成指令集合，其中的每一条指令属于机器体系结构指令集。CPU执行的最小程序单位是指令而不是高级语言程序的语句`


## 六、运行环境
### 1.中断和异常
`中断`：来自处理器CPU执行指令以外的请求事件
比如：
* 输入输出I/O
* 时钟中断
  > 定时器产生时钟中断之后，有时钟中断服务程序更新的部分内容是：
  > 1. 内核中时钟变量的值
  > 2. 当前进程占用CPU的时间
  > 3. 当前进程在时间片内的剩余执行时间

在处理外部中断时，PC（程序计数器）值由`中断隐指令`自动保存，而通用寄存器内容由操作系统保存。


`异常`：指令执行过程中在处理器内部发生的特殊事件，也称为内中断、例外、陷入（陷阱、trap）
比如：
* 程序的非操作码
* 地址越界
* 算术溢出
* 存储保护错误
* 虚存系统的缺页
* 专门的陷入指令

#### 访管中断
用户程序在用户态状态下要使用特权指令引起的中断属于  访管中断
> **访管中断** ：因操作系统不允许用户直接执行某些“危险性高”的指令，因此用户态运行这些指令的结果会转成操作系统的核心态去运行。

### 2.指令
处理器执行的指令被分为两类：
1. `特权指令`：只允许操作系统使用（内核）,任何用户不能执行
2. 非特权指令：可由用户程序执行


#### 用户态可执行指令
* 命令解释程序（命令接口）
* 读时钟指令
* 取数指令
* 寄存器清零
* 访管指令
* 数据存入内存
* 算术运算
* trap指令
* 跳转指令
* 压栈指令


#### 用户态发生事件
* 系统调用
* 外部中断
* 缺页（发生）

#### 核心态可执行指令
* 缺页处理程序（中断）
* 时钟中断处理程序
* 进程调度程序
* 置时钟指令
* 广义指令
* 输入输出 I/O （涉及中断）
* `除了访管指令外的所有指令`


#### 核心态发生事件
* 进程切换


### 3.需要硬件支持的功能
* 时钟管理
* 地址映射
* 中断系统

### 4.系统调用过程
1. 传递系统调用函数
2. 执行陷入（trap）指令
3. 执行相应的服务程序
4. 返回用户态