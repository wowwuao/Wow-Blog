---
title: 0.操作系统经典问题
group:
  path: /os
  order: 1
---

## 一、进程和线程
### 进程
`进程是系统进行`**`资源分配和调度`**`的基本单位`

进程一般由程序、数据集合和进程控制块三部分组成：
* 程序用于描述进程要完成的功能，是控制进程执行的指令集
* 数据集合是程序在执行时所需要的数据和工作区
* 程序控制块，包含进程的描述信息和控制信息，是进程存在的唯一标志。

### 线程
`线程是操作系统能够进行` **`运算调度`** `的最小单位`，其是进程中的一个执行任务（控制单元），负责当前进程中程序的执行。

一个进程至少有一个进程，一个进程可以运行多个线程，这些线程共享同一个内存，线程之间可以共享对象、资源，如果有冲突或需要协同，还可以随时沟通以解决冲突或保持同步。

但实际上，并不是线程越多，进程的工作效率越高，这是因为在一个进程内，不管你创建了多少线程，它们总是被限定在一颗CPU内。或者多核CPU的一个核内。

这意味着，多线程在宏观上是并行的，在微观上则是分时切换串行的，多线程编程无法充分发挥多核计算资源的优势。

这导致使用多线程做任务并行处理时，线程数量超过一定数值后，线程越多速度越慢的原因。

### 区别
1. 本质区别：
   1. 进程是操作系统资源分配的基本单位
   2. 线程是任务调度和执行的基本单位
2. 在开销方面：
   1. 每个进程都有独立的代码和数据空间（程序上下文），程序之间的切换会有较大的开销
   2. 线程可以看做轻量级的进程，同一类线程共享代码和数据空间，每个线程都有自己独立的运行栈和程序计数器（PC），线程之间切换的开销小。
3. 所处环境
   1. 在操作系统中能同时运行多个进程（程序）
   2. 同一个进程（程序）中有多个线程同时执行（通过CPU调度，在每一个时间片中只有一个线程执行）
4. 内存分配方面：
   1. 系统在运行的时候会为每个进程分配不同的内存空间
   2. 系统不会为线程分配内存（线程所使用的资源属于其所属进程的资源），线程组之间只能共享资源。
5. 包含关系
   1. 没有线程的进程可以看做是单线程的，如果一个进程内有多个线程，则执行过程不是一条线的，而是多条线（线程）共同完成的
   2. 线程是进程的一部分，所以线程也被称作轻权或者轻量级进程
### 进程间的通信方式

#### 1. 共享通信
在通信的进程之间存在一块可直接访问的共享空间，通过对这片共享空间进行读写操作实现进程之间的信息交换。

需要使用同步互斥工具。

共享存储分为两种：
   1. 低级方式：基于数据结构的共享
   2. 高级方式：基于存储区的共享

操作系统只负责为通信进程提供可共享使用的存储空间和同步互斥工具，而数据交换则由用户自己安排读写指令完成

#### 2.消息传递
进程通过系统提供的发送消息和接收消息两个原语进行数据交互。

> 原语：进程控制用的程序段，原语的特点是执行期间不允许中断，它是一个不可分割的基本单位。

**直接通信方式**

发送进程直接把消息发送给接受进程，并将它`挂在接收进程的消息缓冲队列上`，接收进程从消息缓冲队列中取得消息。

**间接通信方式**

发送进程把消息发送到某个中间实体，接收进程从中间实体取得消息。这种中间实体一般成为`信箱`，这种方式也成为信箱通信方式。间接通信方式广泛运用于计算机网络中，相应的通信系统成为`电子邮件系统`

#### 3.管道通信
管道通信是消息传递的一种特殊方式，是半双工通信。

若需要全双工通信，则需要定义两个管道。

> 管道：是指用于连接一个读进程和一个写进程以实现它们之间的通信的一个共享文件，又名`pipe文件`

向管道（共享文件）提供输入的发送过程（写进程），以`字符流`的形式将大量的数据送（写）入管道，而接收管道输出的接收进程（读进程）则从管道中接收（读）数据。

为了协同双方的通信，管道机制必须提供以下三方面的协调能力：互斥、同步和确定对方的存在。

## 二、并发和并行
* 并发是宏观概念，两个或多个任务通过任务切换在`同一时间间隔`内发生。
* 并行是微观概念，假设CPU有两个核心，那么我可以同时完成任务A和B，这种同时完成多个任务的情况叫做并行。

